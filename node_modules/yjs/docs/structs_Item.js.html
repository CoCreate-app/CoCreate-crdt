

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: structs/Item.js | yjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="./style.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 162px; height: 162px">
        
            <a href="/" rel="noopener noreferrer" target="_blank">
                <img src="https://yjs.dev/images/logo/yjs-512x512.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">yjs</a></h1>
        
            <span class="version">v13.4.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-encoding.html">encoding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:encoding_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-encoding.html#.applyUpdate">applyUpdate</a></li><li><a href="module-encoding.html#.applyUpdateV2">applyUpdateV2</a></li><li><a href="module-encoding.html#.decodeStateVector">decodeStateVector</a></li><li><a href="module-encoding.html#.decodeStateVectorV2">decodeStateVectorV2</a></li><li><a href="module-encoding.html#.encodeStateAsUpdate">encodeStateAsUpdate</a></li><li><a href="module-encoding.html#.encodeStateAsUpdateV2">encodeStateAsUpdateV2</a></li><li><a href="module-encoding.html#.encodeStateVector">encodeStateVector</a></li><li><a href="module-encoding.html#.encodeStateVectorV2">encodeStateVectorV2</a></li><li><a href="module-encoding.html#.readStateVector">readStateVector</a></li><li><a href="module-encoding.html#.readUpdate">readUpdate</a></li><li><a href="module-encoding.html#.readUpdateV2">readUpdateV2</a></li><li><a href="module-encoding.html#.writeDocumentStateVector">writeDocumentStateVector</a></li><li><a href="module-encoding.html#.writeStateAsUpdate">writeStateAsUpdate</a></li><li><a href="module-encoding.html#.writeStateVector">writeStateVector</a></li><li><a href="module-encoding.html#~cleanupPendingStructs">cleanupPendingStructs</a></li><li><a href="module-encoding.html#~writeStructs">writeStructs</a></li></ul></div></li><li><a href="module-Y.html">Y</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:Y_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-Y.html#~DocOpts">DocOpts</a></li></ul></div></li><li><a href="module-YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray_sub"></div></li><li><a href="module-YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap_sub"></div></li><li><a href="module-YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.html#.cleanupYTextFormatting">cleanupYTextFormatting</a></li><li><a href="module-YText.html#.parent">parent</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.html#~cleanupContextlessFormattingGap">cleanupContextlessFormattingGap</a></li><li><a href="module-YText.html#~cleanupFormattingGap">cleanupFormattingGap</a></li><li><a href="module-YText.html#~equalAttrs">equalAttrs</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-YText.html#~DeltaItem">DeltaItem</a></li><li><a href="module-YText.html#~TextAttributes">TextAttributes</a></li></ul></div></li><li><a href="module-YXml.html">YXml</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-YXml.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-YXml.html#~domFilter">domFilter</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="AbsolutePosition_AbsolutePosition.html">AbsolutePosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbsolutePosition#AbsolutePosition_sub"></div></li><li><a href="AbstractConnector.html">AbstractConnector</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractConnector_sub"></div></li><li><a href="AbstractContent.html">AbstractContent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractContent_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="AbstractContent.html#copy">copy</a></li><li><a href="AbstractContent.html#delete">delete</a></li><li><a href="AbstractContent.html#gc">gc</a></li><li><a href="AbstractContent.html#getContent">getContent</a></li><li><a href="AbstractContent.html#getLength">getLength</a></li><li><a href="AbstractContent.html#getRef">getRef</a></li><li><a href="AbstractContent.html#integrate">integrate</a></li><li><a href="AbstractContent.html#isCountable">isCountable</a></li><li><a href="AbstractContent.html#mergeWith">mergeWith</a></li><li><a href="AbstractContent.html#splice">splice</a></li><li><a href="AbstractContent.html#write">write</a></li></ul></div></li><li><a href="AbstractDSDecoder_AbstractDSDecoder.html">AbstractDSDecoder</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractDSDecoder#AbstractDSDecoder_sub"></div></li><li><a href="AbstractStruct_AbstractStruct.html">AbstractStruct</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractStruct#AbstractStruct_sub"></div></li><li><a href="AbstractType.html">AbstractType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractType_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="AbstractType.html#_dEH">_dEH</a></li><li><a href="AbstractType.html#_eH">_eH</a></li><li><a href="AbstractType.html#_first">_first</a></li><li><a href="AbstractType.html#_item">_item</a></li><li><a href="AbstractType.html#_map">_map</a></li><li><a href="AbstractType.html#_searchMarker">_searchMarker</a></li><li><a href="AbstractType.html#_start">_start</a></li><li><a href="AbstractType.html#doc">doc</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="AbstractType.html#_callObserver">_callObserver</a></li><li><a href="AbstractType.html#_copy">_copy</a></li><li><a href="AbstractType.html#_integrate">_integrate</a></li><li><a href="AbstractType.html#_write">_write</a></li><li><a href="AbstractType.html#observe">observe</a></li><li><a href="AbstractType.html#observeDeep">observeDeep</a></li><li><a href="AbstractType.html#toJSON">toJSON</a></li><li><a href="AbstractType.html#unobserve">unobserve</a></li><li><a href="AbstractType.html#unobserveDeep">unobserveDeep</a></li></ul></div></li><li><a href="ArraySearchMarker_ArraySearchMarker.html">ArraySearchMarker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ArraySearchMarker#ArraySearchMarker_sub"></div></li><li><a href="ContentAny_ContentAny.html">ContentAny</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentAny#ContentAny_sub"></div></li><li><a href="ContentBinary_ContentBinary.html">ContentBinary</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentBinary#ContentBinary_sub"></div></li><li><a href="ContentDeleted_ContentDeleted.html">ContentDeleted</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentDeleted#ContentDeleted_sub"></div></li><li><a href="DeleteItem_DeleteItem.html">DeleteItem</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DeleteItem#DeleteItem_sub"></div></li><li><a href="DeleteSet.html">DeleteSet</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DeleteSet_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="DeleteSet.html#clients">clients</a></li></ul></div></li><li><a href="DSDecoderV1_DSDecoderV1.html">DSDecoderV1</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DSDecoderV1#DSDecoderV1_sub"></div></li><li><a href="DSDecoderV2_DSDecoderV2.html">DSDecoderV2</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DSDecoderV2#DSDecoderV2_sub"></div></li><li><a href="ID_ID.html">ID</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ID#ID_sub"></div></li><li><a href="Item.html">Item</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Item_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Item.html#content">content</a></li><li><a href="Item.html#deleted">deleted</a></li><li><a href="Item.html#info">info</a></li><li><a href="Item.html#keep">keep</a></li><li><a href="Item.html#lastId">lastId</a></li><li><a href="Item.html#left">left</a></li><li><a href="Item.html#marker">marker</a></li><li><a href="Item.html#next">next</a></li><li><a href="Item.html#origin">origin</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parentSub">parentSub</a></li><li><a href="Item.html#prev">prev</a></li><li><a href="Item.html#redone">redone</a></li><li><a href="Item.html#right">right</a></li><li><a href="Item.html#rightOrigin">rightOrigin</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Item.html#delete">delete</a></li><li><a href="Item.html#gc">gc</a></li><li><a href="Item.html#getMissing">getMissing</a></li><li><a href="Item.html#integrate">integrate</a></li><li><a href="Item.html#mergeWith">mergeWith</a></li><li><a href="Item.html#write">write</a></li></ul></div></li><li><a href="module-Y.Doc.html">Doc</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:Y.Doc_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-Y.Doc.html#_item">_item</a></li><li><a href="module-Y.Doc.html#_transaction">_transaction</a></li><li><a href="module-Y.Doc.html#_transactionCleanups">_transactionCleanups</a></li><li><a href="module-Y.Doc.html#share">share</a></li><li><a href="module-Y.Doc.html#subdocs">subdocs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-Y.Doc.html#destroy">destroy</a></li><li><a href="module-Y.Doc.html#get">get</a></li><li><a href="module-Y.Doc.html#getArray">getArray</a></li><li><a href="module-Y.Doc.html#getMap">getMap</a></li><li><a href="module-Y.Doc.html#getText">getText</a></li><li><a href="module-Y.Doc.html#getXmlFragment">getXmlFragment</a></li><li><a href="module-Y.Doc.html#load">load</a></li><li><a href="module-Y.Doc.html#off">off</a></li><li><a href="module-Y.Doc.html#on">on</a></li><li><a href="module-Y.Doc.html#toJSON">toJSON</a></li><li><a href="module-Y.Doc.html#transact">transact</a></li></ul></div></li><li><a href="module-YArray.YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray.YArray_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YArray.YArray.html#_prelimContent">_prelimContent</a></li><li><a href="module-YArray.YArray.html#_searchMarker">_searchMarker</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YArray.YArray.html#_callObserver">_callObserver</a></li><li><a href="module-YArray.YArray.html#_integrate">_integrate</a></li><li><a href="module-YArray.YArray.html#_write">_write</a></li><li><a href="module-YArray.YArray.html#delete">delete</a></li><li><a href="module-YArray.YArray.html#forEach">forEach</a></li><li><a href="module-YArray.YArray.html#get">get</a></li><li><a href="module-YArray.YArray.html#insert">insert</a></li><li><a href="module-YArray.YArray.html#map">map</a></li><li><a href="module-YArray.YArray.html#push">push</a></li><li><a href="module-YArray.YArray.html#Symbol.iterator">Symbol.iterator</a></li><li><a href="module-YArray.YArray.html#toArray">toArray</a></li><li><a href="module-YArray.YArray.html#toJSON">toJSON</a></li><li><a href="module-YArray.YArray.html#unshift">unshift</a></li></ul></div></li><li><a href="module-YArray.YArrayEvent.html">YArrayEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray.YArrayEvent_sub"></div></li><li><a href="module-YMap.YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap.YMap_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YMap.YMap.html#size">size</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YMap.YMap.html#_callObserver">_callObserver</a></li><li><a href="module-YMap.YMap.html#_integrate">_integrate</a></li><li><a href="module-YMap.YMap.html#_write">_write</a></li><li><a href="module-YMap.YMap.html#delete">delete</a></li><li><a href="module-YMap.YMap.html#entries">entries</a></li><li><a href="module-YMap.YMap.html#forEach">forEach</a></li><li><a href="module-YMap.YMap.html#get">get</a></li><li><a href="module-YMap.YMap.html#has">has</a></li><li><a href="module-YMap.YMap.html#keys">keys</a></li><li><a href="module-YMap.YMap.html#set">set</a></li><li><a href="module-YMap.YMap.html#Symbol.iterator">Symbol.iterator</a></li><li><a href="module-YMap.YMap.html#toJSON">toJSON</a></li><li><a href="module-YMap.YMap.html#values">values</a></li></ul></div></li><li><a href="module-YMap.YMapEvent.html">YMapEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap.YMapEvent_sub"></div></li><li><a href="module-YText.ItemTextListPosition.html">ItemTextListPosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.ItemTextListPosition_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.ItemTextListPosition.html#forward">forward</a></li></ul></div></li><li><a href="module-YText.YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.YText_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.YText.html#_pending">_pending</a></li><li><a href="module-YText.YText.html#_searchMarker">_searchMarker</a></li><li><a href="module-YText.YText.html#doc">doc</a></li><li><a href="module-YText.YText.html#length">length</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.YText.html#_callObserver">_callObserver</a></li><li><a href="module-YText.YText.html#_integrate">_integrate</a></li><li><a href="module-YText.YText.html#_write">_write</a></li><li><a href="module-YText.YText.html#applyDelta">applyDelta</a></li><li><a href="module-YText.YText.html#delete">delete</a></li><li><a href="module-YText.YText.html#format">format</a></li><li><a href="module-YText.YText.html#insert">insert</a></li><li><a href="module-YText.YText.html#insertEmbed">insertEmbed</a></li><li><a href="module-YText.YText.html#toDelta">toDelta</a></li><li><a href="module-YText.YText.html#toJSON">toJSON</a></li><li><a href="module-YText.YText.html#toString">toString</a></li></ul></div></li><li><a href="module-YText.YTextEvent.html">YTextEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.YTextEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.YTextEvent.html#_delta">_delta</a></li><li><a href="module-YText.YTextEvent.html#_delta">_delta</a></li><li><a href="module-YText.YTextEvent.html#delta">delta</a></li></ul></div></li><li><a href="module-YXml.YXmlFragment.html">YXmlFragment</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml.YXmlFragment_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YXml.YXmlFragment.html#_prelimContent">_prelimContent</a></li><li><a href="module-YXml.YXmlFragment.html#_prelimContent">_prelimContent</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YXml.YXmlFragment.html#_callObserver">_callObserver</a></li><li><a href="module-YXml.YXmlFragment.html#_integrate">_integrate</a></li><li><a href="module-YXml.YXmlFragment.html#_write">_write</a></li><li><a href="module-YXml.YXmlFragment.html#createTreeWalker">createTreeWalker</a></li><li><a href="module-YXml.YXmlFragment.html#delete">delete</a></li><li><a href="module-YXml.YXmlFragment.html#insert">insert</a></li><li><a href="module-YXml.YXmlFragment.html#querySelector">querySelector</a></li><li><a href="module-YXml.YXmlFragment.html#querySelectorAll">querySelectorAll</a></li><li><a href="module-YXml.YXmlFragment.html#toArray">toArray</a></li><li><a href="module-YXml.YXmlFragment.html#toDOM">toDOM</a></li><li><a href="module-YXml.YXmlFragment.html#toJSON">toJSON</a></li><li><a href="module-YXml.YXmlFragment.html#toString">toString</a></li></ul></div></li><li><a href="module-YXml.YXmlTreeWalker.html">YXmlTreeWalker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml.YXmlTreeWalker_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YXml.YXmlTreeWalker.html#_currentNode">_currentNode</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YXml.YXmlTreeWalker.html#next">next</a></li></ul></div></li><li><a href="PermanentUserData_PermanentUserData.html">PermanentUserData</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="PermanentUserData#PermanentUserData_sub"></div></li><li><a href="RelativePosition.html">RelativePosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="RelativePosition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="RelativePosition.html#item">item</a></li><li><a href="RelativePosition.html#tname">tname</a></li><li><a href="RelativePosition.html#type">type</a></li></ul></div></li><li><a href="Snapshot_Snapshot.html">Snapshot</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Snapshot#Snapshot_sub"></div></li><li><a href="StackItem.html">StackItem</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="StackItem_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="StackItem.html#meta">meta</a></li></ul></div></li><li><a href="Transaction.html">Transaction</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Transaction_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Transaction.html#_mergeStructs">_mergeStructs</a></li><li><a href="Transaction.html#afterState">afterState</a></li><li><a href="Transaction.html#beforeState">beforeState</a></li><li><a href="Transaction.html#changed">changed</a></li><li><a href="Transaction.html#changedParentTypes">changedParentTypes</a></li><li><a href="Transaction.html#deleteSet">deleteSet</a></li><li><a href="Transaction.html#doc">doc</a></li><li><a href="Transaction.html#local">local</a></li><li><a href="Transaction.html#meta">meta</a></li><li><a href="Transaction.html#origin">origin</a></li><li><a href="Transaction.html#subdocsAdded">subdocsAdded</a></li><li><a href="Transaction.html#subdocsLoaded">subdocsLoaded</a></li><li><a href="Transaction.html#subdocsRemoved">subdocsRemoved</a></li></ul></div></li><li><a href="UndoManager.html">UndoManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UndoManager_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UndoManager.html#redoStack">redoStack</a></li><li><a href="UndoManager.html#undoing">undoing</a></li><li><a href="UndoManager.html#undoStack">undoStack</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UndoManager.html#redo">redo</a></li><li><a href="UndoManager.html#stopCapturing">stopCapturing</a></li><li><a href="UndoManager.html#undo">undo</a></li></ul></div></li><li><a href="UpdateDecoderV2_UpdateDecoderV2.html">UpdateDecoderV2</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UpdateDecoderV2#UpdateDecoderV2_sub"></div></li><li><a href="YEvent.html">YEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YEvent.html#_changes">_changes</a></li><li><a href="YEvent.html#changes">changes</a></li><li><a href="YEvent.html#currentTarget">currentTarget</a></li><li><a href="YEvent.html#path">path</a></li><li><a href="YEvent.html#target">target</a></li><li><a href="YEvent.html#transaction">transaction</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YEvent.html#adds">adds</a></li><li><a href="YEvent.html#deletes">deletes</a></li></ul></div></li><li><a href="YXmlElement.html">YXmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlElement_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlElement.html#_prelimAttrs">_prelimAttrs</a></li><li><a href="YXmlElement.html#_prelimAttrs">_prelimAttrs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlElement.html#_copy">_copy</a></li><li><a href="YXmlElement.html#_integrate">_integrate</a></li><li><a href="YXmlElement.html#_write">_write</a></li><li><a href="YXmlElement.html#getAttribute">getAttribute</a></li><li><a href="YXmlElement.html#getAttributes">getAttributes</a></li><li><a href="YXmlElement.html#removeAttribute">removeAttribute</a></li><li><a href="YXmlElement.html#setAttribute">setAttribute</a></li><li><a href="YXmlElement.html#toDOM">toDOM</a></li><li><a href="YXmlElement.html#toString">toString</a></li></ul></div></li><li><a href="YXmlEvent.html">YXmlEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlEvent.html#attributesChanged">attributesChanged</a></li></ul></div></li><li><a href="YXmlHook.html">YXmlHook</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlHook_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlHook.html#hookName">hookName</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlHook.html#_copy">_copy</a></li><li><a href="YXmlHook.html#_write">_write</a></li><li><a href="YXmlHook.html#toDOM">toDOM</a></li></ul></div></li><li><a href="YXmlText.html">YXmlText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlText_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlText.html#_write">_write</a></li><li><a href="YXmlText.html#toDOM">toDOM</a></li><li><a href="YXmlText.html#toJSON">toJSON</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#addChangedTypeToTransaction">addChangedTypeToTransaction</a></li><li><a href="global.html#callTypeObservers">callTypeObservers</a></li><li><a href="global.html#cleanupTransactions">cleanupTransactions</a></li><li><a href="global.html#compareIDs">compareIDs</a></li><li><a href="global.html#compareRelativePositions">compareRelativePositions</a></li><li><a href="global.html#contentRefs">contentRefs</a></li><li><a href="global.html#createAbsolutePosition">createAbsolutePosition</a></li><li><a href="global.html#createAbsolutePositionFromRelativePosition">createAbsolutePositionFromRelativePosition</a></li><li><a href="global.html#createDocFromSnapshot">createDocFromSnapshot</a></li><li><a href="global.html#createRelativePosition">createRelativePosition</a></li><li><a href="global.html#createRelativePositionFromJSON">createRelativePositionFromJSON</a></li><li><a href="global.html#createRelativePositionFromTypeIndex">createRelativePositionFromTypeIndex</a></li><li><a href="global.html#createSnapshot">createSnapshot</a></li><li><a href="global.html#decodeRelativePosition">decodeRelativePosition</a></li><li><a href="global.html#decodeSnapshot">decodeSnapshot</a></li><li><a href="global.html#decodeSnapshotV2">decodeSnapshotV2</a></li><li><a href="global.html#encodeRelativePosition">encodeRelativePosition</a></li><li><a href="global.html#encodeSnapshot">encodeSnapshot</a></li><li><a href="global.html#encodeSnapshotV2">encodeSnapshotV2</a></li><li><a href="global.html#equalSnapshots">equalSnapshots</a></li><li><a href="global.html#findIndexCleanStart">findIndexCleanStart</a></li><li><a href="global.html#findMarker">findMarker</a></li><li><a href="global.html#followRedone">followRedone</a></li><li><a href="global.html#getState">getState</a></li><li><a href="global.html#getStateVector">getStateVector</a></li><li><a href="global.html#getTypeChildren">getTypeChildren</a></li><li><a href="global.html#globalSearchMarkerTimestamp">globalSearchMarkerTimestamp</a></li><li><a href="global.html#isVisible">isVisible</a></li><li><a href="global.html#iterateDeletedStructs">iterateDeletedStructs</a></li><li><a href="global.html#iterateStructs">iterateStructs</a></li><li><a href="global.html#keepItem">keepItem</a></li><li><a href="global.html#logType">logType</a></li><li><a href="global.html#markPosition">markPosition</a></li><li><a href="global.html#mergeDeleteSets">mergeDeleteSets</a></li><li><a href="global.html#overwriteMarker">overwriteMarker</a></li><li><a href="global.html#popStackItem">popStackItem</a></li><li><a href="global.html#readContentAny">readContentAny</a></li><li><a href="global.html#readContentBinary">readContentBinary</a></li><li><a href="global.html#readContentFormat">readContentFormat</a></li><li><a href="global.html#readItemContent">readItemContent</a></li><li><a href="global.html#readRelativePosition">readRelativePosition</a></li><li><a href="global.html#readYXmlElement">readYXmlElement</a></li><li><a href="global.html#refreshMarkerTimestamp">refreshMarkerTimestamp</a></li><li><a href="global.html#snapshot">snapshot</a></li><li><a href="global.html#splitSnapshotAffectedStructs">splitSnapshotAffectedStructs</a></li><li><a href="global.html#transact">transact</a></li><li><a href="global.html#tryGc">tryGc</a></li><li><a href="global.html#tryGcDeleteSet">tryGcDeleteSet</a></li><li><a href="global.html#tryMergeDeleteSet">tryMergeDeleteSet</a></li><li><a href="global.html#tryToMergeWithLeft">tryToMergeWithLeft</a></li><li class="hidden"><a href="global.html#UndoManagerOptions">UndoManagerOptions</a></li><li><a href="global.html#updateMarkerChanges">updateMarkerChanges</a></li><li><a href="global.html#writeRelativePosition">writeRelativePosition</a></li><li><a href="global.html#writeUpdateMessageFromTransaction">writeUpdateMessageFromTransaction</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import {
  GC,
  getState,
  AbstractStruct,
  replaceStruct,
  addStruct,
  addToDeleteSet,
  findRootTypeKey,
  compareIDs,
  getItem,
  getItemCleanEnd,
  getItemCleanStart,
  readContentDeleted,
  readContentBinary,
  readContentJSON,
  readContentAny,
  readContentString,
  readContentEmbed,
  readContentDoc,
  createID,
  readContentFormat,
  readContentType,
  addChangedTypeToTransaction,
  AbstractUpdateDecoder, AbstractUpdateEncoder, ContentType, ContentDeleted, StructStore, ID, AbstractType, Transaction // eslint-disable-line
} from '../internals.js'

import * as error from 'lib0/error.js'
import * as maplib from 'lib0/map.js'
import * as set from 'lib0/set.js'
import * as binary from 'lib0/binary.js'

/**
 * @todo This should return several items
 *
 * @param {StructStore} store
 * @param {ID} id
 * @return {{item:Item, diff:number}}
 */
export const followRedone = (store, id) => {
  /**
   * @type {ID|null}
   */
  let nextID = id
  let diff = 0
  let item
  do {
    if (diff > 0) {
      nextID = createID(nextID.client, nextID.clock + diff)
    }
    item = getItem(store, nextID)
    diff = nextID.clock - item.id.clock
    nextID = item.redone
  } while (nextID !== null &amp;&amp; item instanceof Item)
  return {
    item, diff
  }
}

/**
 * Make sure that neither item nor any of its parents is ever deleted.
 *
 * This property does not persist when storing it into a database or when
 * sending it to other peers
 *
 * @param {Item|null} item
 * @param {boolean} keep
 */
export const keepItem = (item, keep) => {
  while (item !== null &amp;&amp; item.keep !== keep) {
    item.keep = keep
    item = /** @type {AbstractType&lt;any>} */ (item.parent)._item
  }
}

/**
 * Split leftItem into two items
 * @param {Transaction} transaction
 * @param {Item} leftItem
 * @param {number} diff
 * @return {Item}
 *
 * @function
 * @private
 */
export const splitItem = (transaction, leftItem, diff) => {
  // create rightItem
  const { client, clock } = leftItem.id
  const rightItem = new Item(
    createID(client, clock + diff),
    leftItem,
    createID(client, clock + diff - 1),
    leftItem.right,
    leftItem.rightOrigin,
    leftItem.parent,
    leftItem.parentSub,
    leftItem.content.splice(diff)
  )
  if (leftItem.deleted) {
    rightItem.markDeleted()
  }
  if (leftItem.keep) {
    rightItem.keep = true
  }
  if (leftItem.redone !== null) {
    rightItem.redone = createID(leftItem.redone.client, leftItem.redone.clock + diff)
  }
  // update left (do not set leftItem.rightOrigin as it will lead to problems when syncing)
  leftItem.right = rightItem
  // update right
  if (rightItem.right !== null) {
    rightItem.right.left = rightItem
  }
  // right is more specific.
  transaction._mergeStructs.push(rightItem)
  // update parent._map
  if (rightItem.parentSub !== null &amp;&amp; rightItem.right === null) {
    /** @type {AbstractType&lt;any>} */ (rightItem.parent)._map.set(rightItem.parentSub, rightItem)
  }
  leftItem.length = diff
  return rightItem
}

/**
 * Redoes the effect of this operation.
 *
 * @param {Transaction} transaction The Yjs instance.
 * @param {Item} item
 * @param {Set&lt;Item>} redoitems
 *
 * @return {Item|null}
 *
 * @private
 */
export const redoItem = (transaction, item, redoitems) => {
  const doc = transaction.doc
  const store = doc.store
  const ownClientID = doc.clientID
  const redone = item.redone
  if (redone !== null) {
    return getItemCleanStart(transaction, redone)
  }
  let parentItem = /** @type {AbstractType&lt;any>} */ (item.parent)._item
  /**
   * @type {Item|null}
   */
  let left
  /**
   * @type {Item|null}
   */
  let right
  if (item.parentSub === null) {
    // Is an array item. Insert at the old position
    left = item.left
    right = item
  } else {
    // Is a map item. Insert as current value
    left = item
    while (left.right !== null) {
      left = left.right
      if (left.id.client !== ownClientID) {
        // It is not possible to redo this item because it conflicts with a
        // change from another client
        return null
      }
    }
    if (left.right !== null) {
      left = /** @type {Item} */ (/** @type {AbstractType&lt;any>} */ (item.parent)._map.get(item.parentSub))
    }
    right = null
  }
  // make sure that parent is redone
  if (parentItem !== null &amp;&amp; parentItem.deleted === true &amp;&amp; parentItem.redone === null) {
    // try to undo parent if it will be undone anyway
    if (!redoitems.has(parentItem) || redoItem(transaction, parentItem, redoitems) === null) {
      return null
    }
  }
  if (parentItem !== null &amp;&amp; parentItem.redone !== null) {
    while (parentItem.redone !== null) {
      parentItem = getItemCleanStart(transaction, parentItem.redone)
    }
    // find next cloned_redo items
    while (left !== null) {
      /**
       * @type {Item|null}
       */
      let leftTrace = left
      // trace redone until parent matches
      while (leftTrace !== null &amp;&amp; /** @type {AbstractType&lt;any>} */ (leftTrace.parent)._item !== parentItem) {
        leftTrace = leftTrace.redone === null ? null : getItemCleanStart(transaction, leftTrace.redone)
      }
      if (leftTrace !== null &amp;&amp; /** @type {AbstractType&lt;any>} */ (leftTrace.parent)._item === parentItem) {
        left = leftTrace
        break
      }
      left = left.left
    }
    while (right !== null) {
      /**
       * @type {Item|null}
       */
      let rightTrace = right
      // trace redone until parent matches
      while (rightTrace !== null &amp;&amp; /** @type {AbstractType&lt;any>} */ (rightTrace.parent)._item !== parentItem) {
        rightTrace = rightTrace.redone === null ? null : getItemCleanStart(transaction, rightTrace.redone)
      }
      if (rightTrace !== null &amp;&amp; /** @type {AbstractType&lt;any>} */ (rightTrace.parent)._item === parentItem) {
        right = rightTrace
        break
      }
      right = right.right
    }
  }
  const nextClock = getState(store, ownClientID)
  const nextId = createID(ownClientID, nextClock)
  const redoneItem = new Item(
    nextId,
    left, left &amp;&amp; left.lastId,
    right, right &amp;&amp; right.id,
    parentItem === null ? item.parent : /** @type {ContentType} */ (parentItem.content).type,
    item.parentSub,
    item.content.copy()
  )
  item.redone = nextId
  keepItem(redoneItem, true)
  redoneItem.integrate(transaction, 0)
  return redoneItem
}

/**
 * Abstract class that represents any content.
 */
export class Item extends AbstractStruct {
  /**
   * @param {ID} id
   * @param {Item | null} left
   * @param {ID | null} origin
   * @param {Item | null} right
   * @param {ID | null} rightOrigin
   * @param {AbstractType&lt;any>|ID|null} parent Is a type if integrated, is null if it is possible to copy parent from left or right, is ID before integration to search for it.
   * @param {string | null} parentSub
   * @param {AbstractContent} content
   */
  constructor (id, left, origin, right, rightOrigin, parent, parentSub, content) {
    super(id, content.getLength())
    /**
     * The item that was originally to the left of this item.
     * @type {ID | null}
     */
    this.origin = origin
    /**
     * The item that is currently to the left of this item.
     * @type {Item | null}
     */
    this.left = left
    /**
     * The item that is currently to the right of this item.
     * @type {Item | null}
     */
    this.right = right
    /**
     * The item that was originally to the right of this item.
     * @type {ID | null}
     */
    this.rightOrigin = rightOrigin
    /**
     * @type {AbstractType&lt;any>|ID|null}
     */
    this.parent = parent
    /**
     * If the parent refers to this item with some kind of key (e.g. YMap, the
     * key is specified here. The key is then used to refer to the list in which
     * to insert this item. If `parentSub = null` type._start is the list in
     * which to insert to. Otherwise it is `parent._map`.
     * @type {String | null}
     */
    this.parentSub = parentSub
    /**
     * If this type's effect is reundone this type refers to the type that undid
     * this operation.
     * @type {ID | null}
     */
    this.redone = null
    /**
     * @type {AbstractContent}
     */
    this.content = content
    /**
     * bit1: keep
     * bit2: countable
     * bit3: deleted
     * bit4: mark - mark node as fast-search-marker
     * @type {number} byte
     */
    this.info = this.content.isCountable() ? binary.BIT2 : 0
  }

  /**
   * This is used to mark the item as an indexed fast-search marker
   *
   * @type {boolean}
   */
  set marker (isMarked) {
    if (((this.info &amp; binary.BIT4) > 0) !== isMarked) {
      this.info ^= binary.BIT4
    }
  }

  get marker () {
    return (this.info &amp; binary.BIT4) > 0
  }

  /**
   * If true, do not garbage collect this Item.
   */
  get keep () {
    return (this.info &amp; binary.BIT1) > 0
  }

  set keep (doKeep) {
    if (this.keep !== doKeep) {
      this.info ^= binary.BIT1
    }
  }

  get countable () {
    return (this.info &amp; binary.BIT2) > 0
  }

  /**
   * Whether this item was deleted or not.
   * @type {Boolean}
   */
  get deleted () {
    return (this.info &amp; binary.BIT3) > 0
  }

  set deleted (doDelete) {
    if (this.deleted !== doDelete) {
      this.info ^= binary.BIT3
    }
  }

  markDeleted () {
    this.info |= binary.BIT3
  }

  /**
   * Return the creator clientID of the missing op or define missing items and return null.
   *
   * @param {Transaction} transaction
   * @param {StructStore} store
   * @return {null | number}
   */
  getMissing (transaction, store) {
    if (this.origin &amp;&amp; this.origin.client !== this.id.client &amp;&amp; this.origin.clock >= getState(store, this.origin.client)) {
      return this.origin.client
    }
    if (this.rightOrigin &amp;&amp; this.rightOrigin.client !== this.id.client &amp;&amp; this.rightOrigin.clock >= getState(store, this.rightOrigin.client)) {
      return this.rightOrigin.client
    }
    if (this.parent &amp;&amp; this.parent.constructor === ID &amp;&amp; this.id.client !== this.parent.client &amp;&amp; this.parent.clock >= getState(store, this.parent.client)) {
      return this.parent.client
    }

    // We have all missing ids, now find the items

    if (this.origin) {
      this.left = getItemCleanEnd(transaction, store, this.origin)
      this.origin = this.left.lastId
    }
    if (this.rightOrigin) {
      this.right = getItemCleanStart(transaction, this.rightOrigin)
      this.rightOrigin = this.right.id
    }
    if ((this.left &amp;&amp; this.left.constructor === GC) || (this.right &amp;&amp; this.right.constructor === GC)) {
      this.parent = null
    }
    // only set parent if this shouldn't be garbage collected
    if (!this.parent) {
      if (this.left &amp;&amp; this.left.constructor === Item) {
        this.parent = this.left.parent
        this.parentSub = this.left.parentSub
      }
      if (this.right &amp;&amp; this.right.constructor === Item) {
        this.parent = this.right.parent
        this.parentSub = this.right.parentSub
      }
    } else if (this.parent.constructor === ID) {
      const parentItem = getItem(store, this.parent)
      if (parentItem.constructor === GC) {
        this.parent = null
      } else {
        this.parent = /** @type {ContentType} */ (parentItem.content).type
      }
    }
    return null
  }

  /**
   * @param {Transaction} transaction
   * @param {number} offset
   */
  integrate (transaction, offset) {
    if (offset > 0) {
      this.id.clock += offset
      this.left = getItemCleanEnd(transaction, transaction.doc.store, createID(this.id.client, this.id.clock - 1))
      this.origin = this.left.lastId
      this.content = this.content.splice(offset)
      this.length -= offset
    }

    if (this.parent) {
      if ((!this.left &amp;&amp; (!this.right || this.right.left !== null)) || (this.left &amp;&amp; this.left.right !== this.right)) {
        /**
         * @type {Item|null}
         */
        let left = this.left

        /**
         * @type {Item|null}
         */
        let o
        // set o to the first conflicting item
        if (left !== null) {
          o = left.right
        } else if (this.parentSub !== null) {
          o = /** @type {AbstractType&lt;any>} */ (this.parent)._map.get(this.parentSub) || null
          while (o !== null &amp;&amp; o.left !== null) {
            o = o.left
          }
        } else {
          o = /** @type {AbstractType&lt;any>} */ (this.parent)._start
        }
        // TODO: use something like DeleteSet here (a tree implementation would be best)
        // @todo use global set definitions
        /**
         * @type {Set&lt;Item>}
         */
        const conflictingItems = new Set()
        /**
         * @type {Set&lt;Item>}
         */
        const itemsBeforeOrigin = new Set()
        // Let c in conflictingItems, b in itemsBeforeOrigin
        // ***{origin}bbbb{this}{c,b}{c,b}{o}***
        // Note that conflictingItems is a subset of itemsBeforeOrigin
        while (o !== null &amp;&amp; o !== this.right) {
          itemsBeforeOrigin.add(o)
          conflictingItems.add(o)
          if (compareIDs(this.origin, o.origin)) {
            // case 1
            if (o.id.client &lt; this.id.client) {
              left = o
              conflictingItems.clear()
            } else if (compareIDs(this.rightOrigin, o.rightOrigin)) {
              // this and o are conflicting and point to the same integration points. The id decides which item comes first.
              // Since this is to the left of o, we can break here
              break
            } // else, o might be integrated before an item that this conflicts with. If so, we will find it in the next iterations
          } else if (o.origin !== null &amp;&amp; itemsBeforeOrigin.has(getItem(transaction.doc.store, o.origin))) { // use getItem instead of getItemCleanEnd because we don't want / need to split items.
            // case 2
            if (!conflictingItems.has(getItem(transaction.doc.store, o.origin))) {
              left = o
              conflictingItems.clear()
            }
          } else {
            break
          }
          o = o.right
        }
        this.left = left
      }
      // reconnect left/right + update parent map/start if necessary
      if (this.left !== null) {
        const right = this.left.right
        this.right = right
        this.left.right = this
      } else {
        let r
        if (this.parentSub !== null) {
          r = /** @type {AbstractType&lt;any>} */ (this.parent)._map.get(this.parentSub) || null
          while (r !== null &amp;&amp; r.left !== null) {
            r = r.left
          }
        } else {
          r = /** @type {AbstractType&lt;any>} */ (this.parent)._start
          ;/** @type {AbstractType&lt;any>} */ (this.parent)._start = this
        }
        this.right = r
      }
      if (this.right !== null) {
        this.right.left = this
      } else if (this.parentSub !== null) {
        // set as current parent value if right === null and this is parentSub
        /** @type {AbstractType&lt;any>} */ (this.parent)._map.set(this.parentSub, this)
        if (this.left !== null) {
          // this is the current attribute value of parent. delete right
          this.left.delete(transaction)
        }
      }
      // adjust length of parent
      if (this.parentSub === null &amp;&amp; this.countable &amp;&amp; !this.deleted) {
        /** @type {AbstractType&lt;any>} */ (this.parent)._length += this.length
      }
      addStruct(transaction.doc.store, this)
      this.content.integrate(transaction, this)
      // add parent to transaction.changed
      addChangedTypeToTransaction(transaction, /** @type {AbstractType&lt;any>} */ (this.parent), this.parentSub)
      if ((/** @type {AbstractType&lt;any>} */ (this.parent)._item !== null &amp;&amp; /** @type {AbstractType&lt;any>} */ (this.parent)._item.deleted) || (this.parentSub !== null &amp;&amp; this.right !== null)) {
        // delete if parent is deleted or if this is not the current attribute value of parent
        this.delete(transaction)
      }
    } else {
      // parent is not defined. Integrate GC struct instead
      new GC(this.id, this.length).integrate(transaction, 0)
    }
  }

  /**
   * Returns the next non-deleted item
   */
  get next () {
    let n = this.right
    while (n !== null &amp;&amp; n.deleted) {
      n = n.right
    }
    return n
  }

  /**
   * Returns the previous non-deleted item
   */
  get prev () {
    let n = this.left
    while (n !== null &amp;&amp; n.deleted) {
      n = n.left
    }
    return n
  }

  /**
   * Computes the last content address of this Item.
   */
  get lastId () {
    // allocating ids is pretty costly because of the amount of ids created, so we try to reuse whenever possible
    return this.length === 1 ? this.id : createID(this.id.client, this.id.clock + this.length - 1)
  }

  /**
   * Try to merge two items
   *
   * @param {Item} right
   * @return {boolean}
   */
  mergeWith (right) {
    if (
      compareIDs(right.origin, this.lastId) &amp;&amp;
      this.right === right &amp;&amp;
      compareIDs(this.rightOrigin, right.rightOrigin) &amp;&amp;
      this.id.client === right.id.client &amp;&amp;
      this.id.clock + this.length === right.id.clock &amp;&amp;
      this.deleted === right.deleted &amp;&amp;
      this.redone === null &amp;&amp;
      right.redone === null &amp;&amp;
      this.content.constructor === right.content.constructor &amp;&amp;
      this.content.mergeWith(right.content)
    ) {
      if (right.keep) {
        this.keep = true
      }
      this.right = right.right
      if (this.right !== null) {
        this.right.left = this
      }
      this.length += right.length
      return true
    }
    return false
  }

  /**
   * Mark this Item as deleted.
   *
   * @param {Transaction} transaction
   */
  delete (transaction) {
    if (!this.deleted) {
      const parent = /** @type {AbstractType&lt;any>} */ (this.parent)
      // adjust the length of parent
      if (this.countable &amp;&amp; this.parentSub === null) {
        parent._length -= this.length
      }
      this.markDeleted()
      addToDeleteSet(transaction.deleteSet, this.id.client, this.id.clock, this.length)
      maplib.setIfUndefined(transaction.changed, parent, set.create).add(this.parentSub)
      this.content.delete(transaction)
    }
  }

  /**
   * @param {StructStore} store
   * @param {boolean} parentGCd
   */
  gc (store, parentGCd) {
    if (!this.deleted) {
      throw error.unexpectedCase()
    }
    this.content.gc(store)
    if (parentGCd) {
      replaceStruct(store, this, new GC(this.id, this.length))
    } else {
      this.content = new ContentDeleted(this.length)
    }
  }

  /**
   * Transform the properties of this type to binary and write it to an
   * BinaryEncoder.
   *
   * This is called when this Item is sent to a remote peer.
   *
   * @param {AbstractUpdateEncoder} encoder The encoder to write data to.
   * @param {number} offset
   */
  write (encoder, offset) {
    const origin = offset > 0 ? createID(this.id.client, this.id.clock + offset - 1) : this.origin
    const rightOrigin = this.rightOrigin
    const parentSub = this.parentSub
    const info = (this.content.getRef() &amp; binary.BITS5) |
      (origin === null ? 0 : binary.BIT8) | // origin is defined
      (rightOrigin === null ? 0 : binary.BIT7) | // right origin is defined
      (parentSub === null ? 0 : binary.BIT6) // parentSub is non-null
    encoder.writeInfo(info)
    if (origin !== null) {
      encoder.writeLeftID(origin)
    }
    if (rightOrigin !== null) {
      encoder.writeRightID(rightOrigin)
    }
    if (origin === null &amp;&amp; rightOrigin === null) {
      const parent = /** @type {AbstractType&lt;any>} */ (this.parent)
      const parentItem = parent._item
      if (parentItem === null) {
        // parent type on y._map
        // find the correct key
        const ykey = findRootTypeKey(parent)
        encoder.writeParentInfo(true) // write parentYKey
        encoder.writeString(ykey)
      } else {
        encoder.writeParentInfo(false) // write parent id
        encoder.writeLeftID(parentItem.id)
      }
      if (parentSub !== null) {
        encoder.writeString(parentSub)
      }
    }
    this.content.write(encoder, offset)
  }
}

/**
 * @param {AbstractUpdateDecoder} decoder
 * @param {number} info
 */
export const readItemContent = (decoder, info) => contentRefs[info &amp; binary.BITS5](decoder)

/**
 * A lookup map for reading Item content.
 *
 * @type {Array&lt;function(AbstractUpdateDecoder):AbstractContent>}
 */
export const contentRefs = [
  () => { throw error.unexpectedCase() }, // GC is not ItemContent
  readContentDeleted, // 1
  readContentJSON, // 2
  readContentBinary, // 3
  readContentString, // 4
  readContentEmbed, // 5
  readContentFormat, // 6
  readContentType, // 7
  readContentAny, // 8
  readContentDoc // 9
]

/**
 * Do not implement this class!
 */
export class AbstractContent {
  /**
   * @return {number}
   */
  getLength () {
    throw error.methodUnimplemented()
  }

  /**
   * @return {Array&lt;any>}
   */
  getContent () {
    throw error.methodUnimplemented()
  }

  /**
   * Should return false if this Item is some kind of meta information
   * (e.g. format information).
   *
   * * Whether this Item should be addressable via `yarray.get(i)`
   * * Whether this Item should be counted when computing yarray.length
   *
   * @return {boolean}
   */
  isCountable () {
    throw error.methodUnimplemented()
  }

  /**
   * @return {AbstractContent}
   */
  copy () {
    throw error.methodUnimplemented()
  }

  /**
   * @param {number} offset
   * @return {AbstractContent}
   */
  splice (offset) {
    throw error.methodUnimplemented()
  }

  /**
   * @param {AbstractContent} right
   * @return {boolean}
   */
  mergeWith (right) {
    throw error.methodUnimplemented()
  }

  /**
   * @param {Transaction} transaction
   * @param {Item} item
   */
  integrate (transaction, item) {
    throw error.methodUnimplemented()
  }

  /**
   * @param {Transaction} transaction
   */
  delete (transaction) {
    throw error.methodUnimplemented()
  }

  /**
   * @param {StructStore} store
   */
  gc (store) {
    throw error.methodUnimplemented()
  }

  /**
   * @param {AbstractUpdateEncoder} encoder
   * @param {number} offset
   */
  write (encoder, offset) {
    throw error.methodUnimplemented()
  }

  /**
   * @return {number}
   */
  getRef () {
    throw error.methodUnimplemented()
  }
}
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://yjs.dev/images/logo/yjs-512x512.png" style="width: 162px; height: 162px">
    <div class="footer-text">Shared Editing</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
